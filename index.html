<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>My Mapbox Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #filter-buttons {
      position: absolute;
      z-index: 1;
      background: white;
      padding: 10px;
    }
    #filter-buttons button {
      margin: 5px;
      padding: 6px 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      background-color: #fff;
      cursor: pointer;
    }
    #filter-buttons button:hover {
      background-color: #eee;
    }
    #map-title {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 20px;
      font-weight: bold;
      border-radius: 4px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
<div id="map-title">Wonderful World of Wildlife Crossings</div>
<div id="map"></div>
  
<div id="filters" style="position: absolute; top: 10px; left: 10px; background: white; z-index: 2; padding: 10px;">
  <label>Status:</label>
  <select id="filter-status">
    <option value="">All</option>
    <option>Planned Structure</option>
    <option>Completed Structure</option>
    <option>Statewide Analysis</option>
  </select><br>

  <label>Detail:</label>
  <select id="filter-detail">
    <option value="">All</option>
    <option>Case Study</option>
    <option>Technical Specifications</option>
  </select><br>

  <label>Funding:</label>
  <select id="filter-funding">
    <option value="">All</option>
    <option>Wildlife Crossings Pilot Program (WCPP)</option>
    <option>Transportation Alternatives Program</option>
  </select><br>

  <label>Species:</label>
  <select id="filter-species">
    <option value="">All</option>
    <option>Large Mammals</option>
    <option>Ungulates</option>
    <option>Small Mammals</option>
    <option>Reptiles and Amphibians</option>
  </select><br>

  <label>State/Province:</label>
  <select id="filter-region">
    <option value="">All</option>
    <option>California</option>
    <option>Ontario</option>
    <option>Alberta</option>
    <option>British Columbia</option>
    <option>Texas</option>
    <option>New York</option>
  </select><br>

  <button id="reset-filters" style="margin-top: 10px;">Reset Filters</button>
</div>

<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiYXJjc29sdXRpb25zIiwiYSI6ImNsbHBpb2E0NTAydTEzZG9hcmVmdGdvaG4ifQ.caa0jV__lbPqAoJxVAZVlA';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v10',
    center: [-100, 45],
    zoom: 3
  });

  map.addControl(new mapboxgl.NavigationControl(), 'top-right');

  const geojson = {
    type: 'FeatureCollection',
    features: [
      { type: 'Feature', properties: { title: 'Crossing A', type: 'Overpass', status: 'Completed Structure', detail: 'Case Study', funding: 'Wildlife Crossings Pilot Program (WCPP)', species: 'Large Mammals', region: 'California' }, geometry: { type: 'Point', coordinates: [-119.5, 34.2] }},
      { type: 'Feature', properties: { title: 'Crossing B', type: 'Underpass', status: 'Planned Structure', detail: 'Technical Specifications', funding: 'Transportation Alternatives Program', species: 'Ungulates', region: 'Alberta' }, geometry: { type: 'Point', coordinates: [-114, 51] }}
    ]
  };

  const allMarkers = [];

  function renderMarkers() {
    const status = document.getElementById('filter-status').value;
    const detail = document.getElementById('filter-detail').value;
    const funding = document.getElementById('filter-funding').value;
    const species = document.getElementById('filter-species').value;
    const region = document.getElementById('filter-region').value;

    allMarkers.forEach(m => m.remove());
    allMarkers.length = 0;

    geojson.features
      .filter(f => {
        const matchStatus = !status || f.properties.status === status;
        const matchDetail = !detail || f.properties.detail === detail;
        const matchFunding = !funding || f.properties.funding === funding;
        const matchSpecies = !species || f.properties.species === species;
        const matchRegion = !region || f.properties.region === region;
        return matchStatus && matchDetail && matchFunding && matchSpecies && matchRegion;
      })
      .forEach(feature => {
        const marker = new mapboxgl.Marker()
          .setLngLat(feature.geometry.coordinates)
          .setPopup(new mapboxgl.Popup().setHTML(`
            <h4>${feature.properties.title}</h4>
            <p><strong>Status:</strong> ${feature.properties.status}</p>
            <p><strong>Detail:</strong> ${feature.properties.detail}</p>
            <p><strong>Funding:</strong> ${feature.properties.funding}</p>
            <p><strong>Species:</strong> ${feature.properties.species}</p>
            <p><strong>Region:</strong> ${feature.properties.region}</p>
          `))
          .addTo(map);

        allMarkers.push(marker);
      });
  }

  map.on('load', () => {
    renderMarkers();
    ['filter-status', 'filter-detail', 'filter-funding', 'filter-species', 'filter-region'].forEach(id => {
      document.getElementById(id).addEventListener('change', renderMarkers);
    });
  });

  document.getElementById('reset-filters').addEventListener('click', () => {
    ['filter-status', 'filter-detail', 'filter-funding', 'filter-species', 'filter-region'].forEach(id => {
      document.getElementById(id).value = '';
    });

    map.flyTo({
      center: [-100, 45],
      zoom: 3
    });

    renderMarkers();
  });
</script>

</body>
</html>
